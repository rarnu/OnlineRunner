<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>LaTeX Identifier</title>
    <script src="../static/js/jquery-2.0.0.min.js"></script>
    <link href="../static/css/demo.css" rel="stylesheet">
    <script type="text/javascript">
        function identifyImage(idx) {
            $("#result" + idx)[0].innerHTML = "Identifying...";
            $.ajax({
                url: "/latexsample",
                type: "POST",
                dataType: "json",
                data: {
                    format: "jpg",
                    imageIndex: idx
                },
                success: function (data) {
                    console.log("succ!");
                    if (data.result === 0) {
                        $("#result" + idx)[0].innerHTML = data.latex;
                    } else {
                        $("#result" + idx)[0].innerHTML = data.error;
                    }
                },
                error: function () {
                    $("#result" + idx)[0].innerHTML = "Request timeout.";
                }
            });
        }

        function identifyUpload() {
            var img = $("#imgfile")[0].files[0];
            if (img) {
                var fd = new FormData();
                fd.append('image', img);
                $("#result")[0].innerHTML = "Identifying...";
                $.ajax({
                    url: "/latex",
                    type: "POST",
                    dataType: "json",
                    data: fd,
                    processData: false,
                    contentType: false,
                    success: function (data) {
                        console.log("succ!");
                        if (data.result === 0) {
                            $("#result")[0].innerHTML = data.latex;
                        } else {
                            $("#result")[0].innerHTML = data.error;
                        }
                    },
                    error: function () {
                        $("#result")[0].innerHTML = "Request timeout.";
                    }
                });
            }
        }
    </script>
</head>
<body>


<div style="width: 40%; height: 30px; margin-top: 16px; margin-left: 30%; display: block;">
    <div style="float:left;  height: 30px;"><span style="height: 30px; vertical-align: middle; font-size: 1.5em;"><a
            href="index.html">LaTeX Identifier</a></span></div>
</div>

<div style="width: 40%; margin-top: 16px; margin-left: 30%">
    <p>
        <input id="imgfile" type="file" style="border: 1px solid lightgrey; outline: none; height: 28px; width: 300px;">
        <button onclick="identifyUpload();" class="button-demo" style="margin-top: 9px">Go</button>
        <br>
    <div id="result"></div>
    </p>
    <p>
    <div id="latextable" style="width: 640px;">
    </div>
    </p>
</div>


<script type="text/javascript">
    var str = "";
    for (var i = 1; i <= 30; i++) {
        str += "<div class='div-latex-block'>";
        str += "<img src='../static/images/" + i + ".jpg' style='width: 98%; height: 50%; margin-left: 1%; margin-top: 1%'>";
        str += "<button class='button-demo' style='height: 9%;' onclick='identifyImage(" + i + ");'>Go</button>";
        str += "<div id='result" + i + "' style='width: 98%; margin-left: 1%; height: 37%; margin-top: 1%;'></div>";
        str += "</div>";
    }
    $("#latextable")[0].innerHTML = str;
</script>

</body>
</html>